<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>Urban Heat Island Map – Waterloo Region</title>
  <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css">
  <link rel="stylesheet" href="styles.css">
</head>
<body>

  <!-- ── Map ──────────────────────────────────────────── -->
  <div id="map"></div>

  <!-- ── Filter Panel ─────────────────────────────────── -->
  <div class="panel">
    <h3>Filters &amp; Tools <span class="toggle-icon">▾</span></h3>
    <div class="panel-body">

    <label>Min coverage % (show hotter areas)</label>
    <input type="range" id="covMin" min="0.1" max="60" value="0.1" step="0.1">
    <div class="range-labels"><span id="covMinVal">0.1</span>%</div>

    <label>Min buildings per cell</label>
    <input type="range" id="minBuildings" min="0" max="50" value="0">
    <div class="range-labels"><span id="minBuildingsVal">0</span></div>

    <label>Neighborhood</label>
    <select id="neighborhood">
      <option value="">All</option>
    </select>

    <label class="checkbox-label">
      <input type="checkbox" id="sizeEligibleOnly"> Size-eligible only (&lt; 600 m²)
    </label>

    <label>Building type</label>
    <select id="buildingType">
      <option value="">All</option>
      <option value="Residential">Residential</option>
      <option value="Business">Business</option>
      <option value="Mercantile">Mercantile</option>
      <option value="Industrial">Industrial</option>
      <option value="Assembly">Assembly</option>
      <option value="Educational">Educational</option>
      <option value="Institutional">Institutional</option>
      <option value="Agricultural">Agricultural</option>
      <option value="Utility and Miscellaneous">Utility &amp; Misc.</option>
    </select>

    <label>Storey tier</label>
    <select id="storeyTier">
      <option value="">All</option>
      <option value="low">Low (1–2)</option>
      <option value="mid">Mid (3–6)</option>
      <option value="high">High (7+)</option>
    </select>

    <label class="checkbox-label">
      <input type="checkbox" id="showBuildings"> Show building points
    </label>

    <div class="search-row">
      <input type="text" id="searchInput" placeholder="Search address or place...">
      <button id="searchBtn">Go</button>
    </div>

    <label>View</label>
    <div class="view-btns">
      <button class="btn active" id="viewHeatBtn">Heatmap</button>
      <button class="btn secondary" id="viewGridBtn">Grid</button>
      <button class="btn secondary" id="viewOffBtn">Off</button>
    </div>

    <button class="btn" id="drawAreaBtn">Draw area to analyze</button>
    <button class="btn secondary" id="exportBtn">Export filtered buildings</button>
    <button class="btn secondary" id="resetBtn">Reset view</button>
    </div><!-- .panel-body -->
  </div>

  <!-- ── Legend ────────────────────────────────────────── -->
  <div class="legend">
    <h3>Urban heat intensity</h3>
    <div class="legend-scale">
      <span style="background:#2166ac"></span>
      <span style="background:#4393c3"></span>
      <span style="background:#92c5de"></span>
      <span style="background:#d1e5f0"></span>
      <span style="background:#f7f7f7"></span>
      <span style="background:#fddbc7"></span>
      <span style="background:#f4a582"></span>
      <span style="background:#d6604d"></span>
      <span style="background:#b2182b"></span>
    </div>
    <div class="legend-labels"><span>Sparse</span><span>Dense</span></div>
    <p class="hint">Click map for cell stats</p>
  </div>

  <!-- ── Detail Panel ─────────────────────────────────── -->
  <div class="detail-panel" id="detailPanel">
    <span class="close" id="closeDetail">&times;</span>
    <h4>Cell / Area Stats</h4>
    <div id="detailContent"></div>
  </div>

  <!-- ── Chat UI ──────────────────────────────────────── -->
  <button class="chat-toggle" id="chatToggle" title="Grant Advisor Chat">&#128172;</button>
  <div class="chat-panel" id="chatPanel">
    <div class="chat-header">
      <span>Grant Targeting Advisor</span>
      <button class="chat-new" id="chatNewBtn" title="New conversation">New chat</button>
    </div>
    <div class="chat-messages" id="chatMessages">
      <div class="chat-msg system">Ask me about grant eligibility, priority areas, or building analysis.</div>
    </div>
    <div class="chat-typing" id="chatTyping">Thinking <span class="dot"></span><span class="dot"></span><span class="dot"></span></div>
    <div class="chat-input-row">
      <input type="text" id="chatInput" placeholder="Ask about grants, areas, eligibility...">
      <button id="chatSendBtn">Send</button>
    </div>
  </div>

  <!-- ── Loading Overlay ────────────────────────────────── -->
  <div class="loading-overlay" id="loadingOverlay">
    <div class="loading-spinner"></div>
    <p>Loading map data…</p>
  </div>

  <!-- ── Scripts ─────────────────────────────────────── -->
  <script src="https://cdn.jsdelivr.net/npm/marked/marked.min.js"></script>
  <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
  <script src="https://unpkg.com/leaflet.heat@0.2.0/dist/leaflet-heat.js"></script>
  <script src="app.js"></script>

</body>
</html>
